# GMS问题总结 (持续更新...)

当出现GMS问题时，可以按照以下方式进行排查

```
Step1:测试之前先查看测试注意事项:http://online.mediatek.com/QuickStart/QS00017#QSS00138
Step2:请确认retry是否可以pass？如果retry可以pass；可以不必纠结此Fail；
Step3:确认最新的daily build tool是否可以pass？若可以pass（合法有效,google认可）,则不必纠结此Fail；
Step4:确认单跑（单个case或单跑模块）是否可以pass? 如果单跑可以pass,则不必纠结此Fail；
Step5:手机恢复出厂设置后是否可以pass？如果可以pass,则不必纠结此Fail；
Step6:更换测试机或者辅助机是否可以pass？如果可以pass,则不必纠结此Fail；
Step7:进入MTK CTS快速入门：http://online.mediatek.com
查看对应版本google issue栏位，查找对应项是否为Google issue，如果是google issue，则不需要纠结此Fail；
Step8:进入MTK FAQ 搜索
```

**以下是当前项目进行GMS认证碰到的问题总结，请结合测试工具版本以及android版本进行实际判断**

### CTS

| Redmine | Tools     | Test case                                                                                                                                                                                                                                                                                                                                                                                                 | Note                                                                                                             |
| ------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| 111710  | CTS11R5   | 【模块】：CtsAppSecurityHostTestCases<br/>【case】：android.appsecurity.cts.ApexSignatureVerificationTest#testApexPubKeyIsNotWellKnownKey<br/>android.appsecurity.cts.AuthBoundKeyTest#useInvalidatedAuthBoundKey                                                                                                                                                                                                 | com.android.i18n；com.android.runtime；com.android.art<br/>以上3个APEX需要使用自定义签名<br/>报错的apex使用了google默认签名， 所以导致测试Fail. |
| 111715  | CTS11R5   | 【模块】：CtsAppTestCases<br/>【case】：<br />android.app.cts.SystemFeaturesTest#testSensorFeatures                                                                                                                                                                                                                                                                                                               | 项目mk文件中缺少对Sensor的配置                                                                                              |
| 111719  | CTS11R5   | 【模块】：CtsDevicePolicyManagerTestCases<br/>【case】：<br />com.android.cts.devicepolicy.MixedDeviceOwnerTest#testLockTask_defaultDialer<br/>com.android.cts.devicepolicy.MixedProfileOwnerTest#testLockTask_defaultDialer                                                                                                                                                                                      | 需要将mtk的dialer设置成默认                                                                                               |
| 111737  | CTS11R5   | 【模块】：CtsOsTestCases<br/>【case】：android.os.cts.BuildVersionTest#testBuildFingerprint                                                                                                                                                                                                                                                                                                                       | BUILD_KEYS need release-keys                                                                                     |
| 111734  | CTS11R5   | 【模块】：CtsMediaTestCases<br/>【case】：android.media.cts.MediaCodecListTest#testAllComponentInstantiation                                                                                                                                                                                                                                                                                                      | 自定义OMX.MTK.AUDIO.DECODER.WMA初始化失败                                                                                |
| 111729  | CTS11R5   | 【模块】：CtsLibcoreTestCases<br/>【case】：com.android.org.conscrypt.javax.net.ssl.SSLEngineTest#test_SSLEngine_getSupportedCipherSuites_connect<br/>com.android.org.conscrypt.TrustManagerImplTest#testHttpsEndpointIdentification<br/>com.android.org.conscrypt.java.security.KeyPairGeneratorTest#test_getInstance                                                                                            | 需正确配置fingerprint                                                                                                 |
| 152180  | CTS11R8   | 【模块】：CtsOmapiTestCases<br/>【case】：android.omapi.cts.OmapiTest#testGetReaders                                                                                                                                                                                                                                                                                                                              |                                                                                                                  |
| 152231  | CTS11R8   | 【模块】：CtsCameraTestCases<br/>【case】：<br />android.hardware.cts.CameraGLTest#testSetPreviewTextureBothCallbacks<br/>android.hardware.cts.CameraGLTest#testCameraToSurfaceTextureMetadata<br/>android.hardware.camera2.cts.CameraDeviceTest#testCameraDevicePreviewTemplate[1](http://192.168.3.78:8078/issues/152231#fn1)<br/>etc...                                                                        |                                                                                                                  |
| 155079  | CTS11R8   | 【模块】：CtsViewTestCases<br/>【case】：android.view.cts.KeyEventTest#testKeyCodeFromString                                                                                                                                                                                                                                                                                                                      | LAST_KEYCODE为288，但LAST_KEYCODE+1为289，刚好在我们自定义按键的区间中，判断错误，未通过，修改自定义keyEvent即可                                     |
| 152212  | CTS11R8   | 【模块】：CtsTelephonyTestCases<br/>【case】：android.telephony.cts.SmsUsageMonitorShortCodeTest#testSmsShortCodeDestination                                                                                                                                                                                                                                                                                      | google 修改了 fw Italy SMS shortcode但未做cts测试工具同步，修改shortcode即可                                                      |
| 155108  | CTS11R8   | 【模块】：CtsSensorTestCases<br/>【case】：android.hardware.cts.SensorBatchingTests#testGyroscope_50hz_batching                                                                                                                                                                                                                                                                                                   |                                                                                                                  |
| 155105  | CTS11R8   | 【模块】：CtsMediaTestCases<br/>【case】：<br />android.media.cts.MediaCodecListTest#testAllComponentInstantiation<br/>android.media.cts.DecodeEditEncodeTest#testVideoEditQCIF<br/>android.media.cts.CamcorderProfileTest#testGetWithId                                                                                                                                                                          | 需要降PQ_ADL_INDEX_DEFAULT默认关闭，且提高highspeed模式下视频的帧率 >= 90                                                           |
| 155076  | CTS11R8   | 【模块】：CtsStagedInstallHostTestCases<br/>【case】：com.android.tests.stagedinstall.host.StagedInstallTest#testInstallStagedApexAndApk                                                                                                                                                                                                                                                                          | Google patch fix                                                                                                 |
| 157671  | CTS11R9   | 【模块】：CtsSecurityHostTestCases<br/>【case】：android.security.cts.SELinuxHostTest#testNoBugreportDenials                                                                                                                                                                                                                                                                                                      | 为客户dl_wificonfig_service配置selinux后fix                                                                            |
| 157669  | CTS11R9   | 【模块】：CtsViewTestCases<br/>【case】：android.view.cts.DisplayRefreshRateTest#testRefreshRate                                                                                                                                                                                                                                                                                                                  | 修改帧率达到要求(60+-2 )即可                                                                                               |
| 161680  | CTS11R9   | 【模块】：CtsMediaTestCases<br/>【case】：android.media.cts.VideoDecoderPerfTest#testMpeg4Goog0Perf1280x0720                                                                                                                                                                                                                                                                                                      | 配置对应分辨率(1280x0720)的视频解码即可                                                                                        |
| 159519  | CTS11R9   | 【模块】：CtsRoleTestCases<br/>【case】：<br />android.app.role.cts.RoleManagerTest#openDefaultAppListThenIsNotDefaultAppInList<br/>android.app.role.cts.RoleManagerTest#removeSmsRoleHolderThenPermissionIsRevoked                                                                                                                                                                                               | 关闭SMS版本测试                                                                                                        |
| 159377  | CTS11R9   | 【模块】：CtsSensorTestCases<br/>【case】：android.hardware.cts.SensorTest#testSensorOperations<br/>android.hardware.cts.SensorTest#testSensorTimeStamps                                                                                                                                                                                                                                                          | 需要考虑wwan和wlan兼容的问题，wwan和wlan 用的sensor不同                                                                          |
| 159358  | CTS11R9   | 【模块】：CtsSecurityBulletinHostTestCases(only on wlan)<br/>【case】：android.security.cts.Poc20_06#testPocCVE_2020_3635                                                                                                                                                                                                                                                                                         | 与系统服务有关，其中一个服务无法启动，导致STS测不了.<br/>当前修改方案在init.rc中添加:<br/>on property:ro.boot.rsc=m11_wlan_gms<br/>stop vtservice  |
| 163283  | CTS11R9   | 【模块】：CtsAppSecurityHostTestCases<br/>【case】：android.appsecurity.cts.ApexSignatureVerificationTest#testApexPubKeyIsNotWellKnownKey                                                                                                                                                                                                                                                                         | 工具的缓存会影响测试结果，测试前先清除工具的缓存                                                                                         |
| 162163  | CTS11R9   | 【模块】：CtsAppTestCases<br/>【case】：android.app.cts.SystemFeaturesTest#testLocationFeatures                                                                                                                                                                                                                                                                                                                   | 与移除了location相关的feature有关,加回来可以pass                                                                               |
| 162142  | CTS11R9   | 【模块】：CtsLocationFineTestCases<br/>【case】：android.location.cts.fine.LocationManagerFineTest#testGetProvider                                                                                                                                                                                                                                                                                                |                                                                                                                  |
| 168793  | CTS11R9   | 【模块】：CtsSensorTestCases<br/>【case】：ndroid.hardware.cts.SensorBatchingTests#testGyroscope_fastest_batching                                                                                                                                                                                                                                                                                                 |                                                                                                                  |
| 171328  | CTS11R10  | 【模块】：CtsSystemUiTestCases<br/>【case】：android.systemui.cts.LightBarTests#testLightNavigationBar                                                                                                                                                                                                                                                                                                            | 与165946 虚拟导航修改有关<br/>若虚拟导航隐藏，显示ASSUMPTION_FAILURE<br/>但由于将navigation_bar_height修改为0.1，此项就会检测到导航栏，没有满足要求，failed   |
| 178208  | CTS11R10  | 【模块】：CtsAppTestCases(AOSP)<br/>【case】：android.app.cts.SystemFeaturesTest#testLocationFeatures                                                                                                                                                                                                                                                                                                             | AOSP未集成GMS包，同时也未集成第三方nlp服务,导致网络定位不可用                                                                             |
| 176119  | STS11R11  | 【模块】：CtsSecurityTestCases<br/>【case】：android.security.cts.CVE_2022_20456#testPocCVE_2022_20456                                                                                                                                                                                                                                                                                                            | 检查对应的patch是否合入                                                                                                   |
| 174621  | CTS11R10  | 【模块】：CtsWindowManagerDeviceTestCases<br/>【case】：android.server.wm.MultiDisplaySystemDecorationTests#testNavBarNotShowingOnDisplayWithoutDecor<br/>android.server.wm.MultiDisplaySystemDecorationTests#testNavBarShowingOnDisplayWithDecor<br/>android.server.wm.MultiDisplaySystemDecorationTests#testNavBarNotShowingOnPrivateDisplay<br/>android.server.wm.WindowMetricsTests#testMetricsMatchesDisplay | 开启手势导航后可以测试pass,默认关闭虚拟按键，仅提供手势开关                                                                                 |
| 174619  | CTS11R10  | 【模块】：CtsViewTestCases<br/>【case】：android.view.cts.ViewTest#testGetWindowVisibleDisplayFrame                                                                                                                                                                                                                                                                                                               | 开启手势导航后可以测试pass,默认关闭虚拟按键，仅提供手势开关                                                                                 |
| 274732  | CTS 14_r4 | 【模块】：CtsCameraTestCases<br>【case】：android.hardware.camera2.cts.StillCaptureTest#testFullRawZSLCapture1<br>android.hardware.camera2.cts.StillCaptureTest#testFullRawCapture1<br>android.hardware.camera2.cts.StillCaptureTest#testBasicRawCapture1                                                                                                                                                         | 修改camera metadata文件                                                                                              |
| 274608  | CTS 14_r4 | 【模块】：CtsAppCloningHostTest<br>【case】：com.android.cts.appcloning.AppCloningHostTest#testCrossUserMediaAccess<br>com.android.cts.appcloning.AppCloningHostTest#testRemoveClonedProfileMediaProviderCleanup<br>com.android.cts.appcloning.AppCloningStorageHostTest#testVerifyStatsExternalForClonedUser                                                                                                     | MTK释放patch                                                                                                       |
| 274606  | CTS 14_r4 | 【模块】：CtsAccessibilityServiceTestCases<br>【case】：android.accessibilityservice.cts.AccessibilityGestureDetectorTest#testRecognizeGesturePathOnVirtualDisplay<br>android.accessibilityservice.cts.AccessibilityGestureDetectorTest#testVerifyGestureTouchEventOnVirtualDisplay<br>android.accessibilityservice.cts.AccessibilityTakeScreenshotTest#testTakeScreenshotOnVirtualDisplay_GetScreenshotResult    | 修改multi-window配置                                                                                                 |
| 274617  | CTS 14_r4 | 【模块】：CtsInputTestCases<br>【case】：android.input.cts.StylusButtonInputEventTest#testStylusButtonsDisabledMotionEvents<br>android.input.cts.StylusButtonInputEventTest#testStylusButtonsEnabledMotionEvents<br>android.input.cts.TouchModeTest#testTouchModeUpdate_DisplayHasOwnFocus<br>android.input.cts.TouchScreenTest#testTouchScreenPrecisionOrientation0                                              |                                                                                                                  |

### CTSV
| Redmine | Tools | Test case                                                                       | Note                                                                                 |
| ------- | ----- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------ |
| 274057  | CTSV  | 测试CTSV时，返回键有时会出现失灵现象                                                            | A14新特性:MtkSettings配置了android:enableOnBackInvokedCallback="true" ，导致事件不走ViewRootImpl了 |
| 274333  | CTSV  | Device Suspend Tests测试项失败                                                       | 正确配置sensor                                                                           |
| 274433  | CTSV  | 测试机连接AudioBox时，无法给AudioBox供电                                                    | 更改供电配置                                                                               |
| 274440  | CTSV  | Camera ITS前摄和后摄场景0均Fail                                                         |                                                                                      |
| 274455  | CTSV  | Camera ITS中A14新增项scene_extensions/scene_hdr和scene_extensions/scene_night测试时出现报错 |                                                                                      |
| 274477  | CTSV  | Bubble Notification Test中打开Bubble无法编辑导致测试失败                                     | Bubble显示有问题                                                                          |
|         |       |                                                                                 |                                                                                      |

### GTS

| Redmine | Tools         | Test case                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Note                                                                                                                                                                                                                                      |
| ------- | ------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 111776  | GTS9R1（11-12） | 【模块】：GtsAppBlacklistDeviceTestCases<br/>【case】：com.google.android.appblacklist.gts.GtsAppBlacklistDeviceTest#testForBlacklistedApps                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 集成release key后可以pass                                                                                                                                                                                                                      |
| 111778  | GTS9R1（11-12） | 【模块】：GtsBackupHostTestCases<br/>【case】：com.google.android.gts.backup.BackupHostTest#testGmsBackupTransportIsDefault                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                           |
| 111782  | GTS9R1（11-12） | 【模块】：GtsPermissionTestCases<br/>【case】：com.google.android.permission.gts.PreloadAppsTargetSdkVersionTest#testPreloadedAppsTargetSdkVersion                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 预制APK的 target SDK必须达到版本要求                                                                                                                                                                                                                 |
| 111786  | GTS9R1（11-12） | 【模块】：GtsWellbeingTestCases<br/>【case】：com.google.android.wellbeing.gts.WellbeingTest#testQuickSettingsAutoAddContainFocusModeTile<br/>com.google.android.wellbeing.gts.WellbeingTest#testQuickSettingsAutoAddContainWindDownTile                                                                                                                                                                                                                                                                                                                                                             | Quick Settings菜单中缺少focus_mode_first_time_setup=ComponentInfo                                                                                                                                                                              |
| 152026  | GTS 9.1_r2    | 【模块】：GtsAssistantHostTestCases<br/>【case】：com.google.android.assistant.gts.AssistantTest#testAssistantTakePhotoWithVoiceInteraction<br/>com.google.android.assistant.gts.AssistantTest#testAssistantTakeSelfieWithVoiceInteraction<br/>com.google.android.assistant.gts.AssistantTest#testAssistantTakeSelfieWithoutVoiceInteraction<br/>etc...                                                                                                                                                                                                                                              | 通过语音助手调出照片、相机等功能                                                                                                                                                                                                                          |
| 152028  | GTS 9.1_r2    | 【模块】：GtsGmscoreHostTestCases<br/>【case】：com.google.android.gts.devicepolicy.managedprovisioning.DeviceOwnerProvisioningHostsideTest#testRequiredAppsInManagedDevice<br/>com.google.android.gts.devicepolicy.managedprovisioning.DeviceOwnerProvisioningHostsideTest#testRequiredAppsInManagedUser<br/>com.google.android.gts.devicepolicy.managedprovisioning.ManagedProfileProvisioningHostsideTest#testRequiredApps<br/>com.google.android.gts.security.AttestationRootHostTest#testEcAttestationChain<br/>com.google.android.gts.security.AttestationRootHostTest#testRsaAttestationChain | 由于device owner下没有APK持有intent为android.intent.action.VIEW_DOWNLOADS.<br/>原因是device owner会移除不在白名单的应用,我们就需要将持有该intent action的应用加入到白名单.<br/>默认是com.android.doucumentUI,导入GMS后包名为com.google.android.doucumentUI,我们将google的doucumentui加入到白名单中即可. |
| 152031  | GTS 9.1_r2    | 【模块】：GtsMbaPrivilegedPermissionTestCases<br/>【case】：com.google.android.mbaprivilegedpermission.gts.GtsDebugCertificateTest#testMbaPrivilegedPermission                                                                                                                                                                                                                                                                                                                                                                                                                                       | need release-key                                                                                                                                                                                                                          |
| 152033  | GTS 9.1_r2    | 【模块】：GtsNetworkStackHostTestCases<br/>【case】：com.google.android.gts.networkstack.NetworkStackHostTest#testNetworkStack<br/>com.google.android.gts.networkstack.NetworkStatsHostTest#testNetworkStatsProvider                                                                                                                                                                                                                                                                                                                                                                                 | wlan和wwan设备配置有关                                                                                                                                                                                                                           |
| 152037  | GTS 9.1_r2    | 【模块】：GtsTelephonyNumberVerificationHostCases<br/>【case】：com.google.android.gts.telephony.numberverification.NumberVerificationHostTest#testNumberVerification                                                                                                                                                                                                                                                                                                                                                                                                                                |                                                                                                                                                                                                                                           |
| 155049  | GTS 10_r1     | 【模块】：GtsBootHealthHostTestCases<br/>【case】：android.boothealth.gts.BootHealthHostTest#testUpdatableProcessCrashNotDetected                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                           |
| 155054  | GTS 10_r1     | 【模块】：GtsMediaTestCases<br/>【case】：com.google.android.media.gts.WidevineH264PlaybackTests#testL3With1080P30UsingExo2Extractor<br/>com.google.android.media.gts.WidevineH264PlaybackTests#testL3With1080P30ProfileHighLevel40UsingExo2Extractor<br/>com.google.android.media.gts.WidevineH264PlaybackTests#testCbcsL3With1080P30UsingExo2Extractor<br/>etc...                                                                                                                                                                                                                                  | 对于 WidevineH264PlaybackTests ：<br/>贵司平台运行内存只有2G ， 即 [ro.vendor.mtk_config_max_dram_size]: [0x800000000] 。<br/>case failed 的原因是： 通过google avc sw decoder 解码时， 因为平台性能不足，导致无法正常播放1080P视频。                                                    |
| 157312  | GTS 10_r1     | 【模块】：GtsGmscoreHostTestCases<br/>【case】：com.google.android.gts.provisioning.ProvisioningHostTest#testDeviceProvisioningPackageName<br/>com.google.android.gts.provisioning.ProvisioningHostTest#testDisablingDeviceProvisioningPackage                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                           |
| 170342  | GTS 10_r2     | 【模块】：GtsPermissionTestCases<br/>【case】：com.google.android.permission.gts.ActivityRecognitionPermissionTest#activityRecognitionPermissionNotGrantedForPostPUpgrade                                                                                                                                                                                                                                                                                                                                                                                                                            | need update patch                                                                                                                                                                                                                         |
| 170957  | GTS 10_r2     | 【模块】：GtsAndroidAutoDeviceTestCases<br/>【case】：com.google.android.androidauto.gts.AndroidAutoTest#androidAutoHasNotificationAccess                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 圆点通知客制化导致                                                                                                                                                                                                                                 |
| 170964  | GTS 10_r2     | 【模块】：GtsMbaPrivilegedPermissionTestCases<br/>【case】：com.google.android.mbaprivilegedpermission.gts.GtsNotificationAccessListenersTest#testMbaPrivilegedPermission                                                                                                                                                                                                                                                                                                                                                                                                                            | app没有声明ACCESS_NOTIFICATIONS权限，因此需要将config_defaultListenerAccessPackages中的声明去除                                                                                                                                                             |
| 274214  | GTS 11_r4     | 【模块】：GtsPackageSignatureTest<br>【case】：android.security.cts.PackageSignatureTest#testPackageSignatures                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | com.android.i18n, com.android.rkpd, com.android.runtime, com.android.virt, com.android.vndk.v30, com.android.vndk.v31, com.android.vndk.v33, com.android.vndk.v34需要自定义签名。                                                                 |
| 274198  | GTS 11_r4     | 【模块】：GtsApexSignatureVerificationTest  <br>【case】：android.appsecurity.cts.ApexSignatureVerificationTest#testApexPubKeyIsNotWellKnownKey                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 需要自定义签名                                                                                                                                                                                                                                   |



### STS



### VTS