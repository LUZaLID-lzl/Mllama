# 二检工模设计

### 问题背景：【218859】【工厂需求】XQT518 二检工模需求评估

上周日与客户面对面沟通，客户现在无法确认老化后的机器已经进行过二检，且功能检验OK；
针对客户的疑问，现提出如下需求，请研发协助

1. 仿照一检工模，复制一套二检工模，供老化后二检检验使用，相比一检工模测试项会减少部分具体工模测试项可与我沟通；
2. 二检工模也需要有工模标志位生成，现在恢复工位后移至二检后，工模标志位可以在恢复工位进行检查。
3. 标志位涉及一检工模、老化、二检工模。 不能全部靠恢复检查，能否实现老化检查一检工模标志位，二检检查老化标志位，恢复检查二检标志位。



针对工厂的需求，需要开发二检工模，以及针对

### 整体架构图：

![](/home/liziluo/LUZaLID/TyporaPicture/二检工模/1.png)



用户在拨号界面输入暗码，根据暗码的不同来启动对应的应用。并且，在特定的应用启动前会进行判断，当不符合条件时会弹框进行提示。

测试应用测试完成后会将数据写入到NVRAM中保存，供其他工具读取，在下一次进入测试应用时，也会从NVRAM中读取来同步数据。 

### 流程图：

![](/home/liziluo/LUZaLID/TyporaPicture/二检工模/2.png)

### NVRAM存储位置变化：

MR2以及MR3的nv位置变化如下

![](/home/liziluo/LUZaLID/TyporaPicture/二检工模/3.png)

### 改动点：

**一检工模**：不需要进行改动。

**老化测试**：新增在测试完成后，将测试结果写入nvram中，生成老化标志位，供二检工模使用。驱动需要提供老化标志位节点，老化标志位位置由工厂提供。

**二检工模**：将一检工模的功能复制出来，独立成为一个新的应用，后续根据工厂的需求来适配测试项。同时，需要生成二检工模标志位以及存储单项测试数据。

驱动需要提供二检工模的QC标志位节点，二检工模标志位位置由工厂提供。单项测试节点可以按照一检工模的字符串形式，提供一个长度至少为23位的节点供二检工模写入（请预留部分连续空间，以防新增测试项）。

**测试入口**：

1：老化测试：增加暗码判断条件，当一检工模标志位不为true时，禁止进入老化测试并弹框提示。

2：二检工模：新增进入暗码（ *#**673#），增加暗码判断条件，当老化测试标志位不为true时，禁止进入二检工模并弹框提示。

3：新增强制进入老化测试暗码：（ *#**6744#）。

4：新增强制进入二检工模暗码：（ *#**6733#）。

